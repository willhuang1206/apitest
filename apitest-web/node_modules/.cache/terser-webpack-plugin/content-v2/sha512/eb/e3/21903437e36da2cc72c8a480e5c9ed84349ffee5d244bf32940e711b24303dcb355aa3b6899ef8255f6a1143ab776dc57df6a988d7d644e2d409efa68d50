{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-646cc424\"],{1899:function(t,e,a){\"use strict\";a.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(\"div\",{staticStyle:{margin:\"35px\"}},[s(\"el-col\",{staticClass:\"toolbar\",staticStyle:{\"padding-bottom\":\"0px\"},attrs:{span:24}},[s(\"el-form\",{attrs:{inline:!0,model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[s(\"el-form-item\",[s(\"el-input\",{attrs:{placeholder:\"名称\"},nativeOn:{keyup:function(e){return!e.type.indexOf(\"key\")&&t._k(e.keyCode,\"enter\",13,e.key,\"Enter\")?null:t.handleSearch(e)}},model:{value:t.filters.name,callback:function(e){t.$set(t.filters,\"name\",\"string\"===typeof e?e.trim():e)},expression:\"filters.name\"}})],1),t._v(\" \"),s(\"el-form-item\",[s(\"el-button\",{attrs:{type:\"primary\"},on:{click:t.handleSearch}},[t._v(\"查询\")])],1),t._v(\" \"),s(\"el-form-item\",[s(\"el-button\",{attrs:{type:\"primary\"},on:{click:t.handleAdd}},[t._v(\"新增\")])],1)],1)],1),t._v(\" \"),s(\"el-dialog\",{attrs:{width:\"40%\",title:t.formTitle,visible:t.taskVShow,\"close-on-click-modal\":!1},on:{\"update:visible\":function(e){t.taskVShow=e}}},[s(\"el-form\",{ref:\"form\",attrs:{model:t.form,\"label-width\":\"100px\",rules:t.formRules}},[s(\"el-form-item\",{attrs:{label:\"任务名称：\",prop:\"name\"}},[s(\"el-input\",{attrs:{disabled:\"run\"===t.taskVType,placeholder:\"请输入任务名称\"},model:{value:t.form.name,callback:function(e){t.$set(t.form,\"name\",\"string\"===typeof e?e.trim():e)},expression:\"form.name\"}})],1),t._v(\" \"),s(\"el-form-item\",{attrs:{label:\"用例：\",prop:\"automations\"}},[s(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{disabled:\"run\"===t.taskVType,filterable:\"\",multiple:\"\",placeholder:\"请选择\"},model:{value:t.form.automations,callback:function(e){t.$set(t.form,\"automations\",e)},expression:\"form.automations\"}},t._l(t.automationlist,(function(t){return s(\"el-option\",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),t._v(\" \"),s(\"el-form-item\",{attrs:{label:\"执行环境\",prop:\"env\"}},[s(\"el-select\",{attrs:{disabled:\"run\"===t.taskVType,placeholder:\"执行环境\"},model:{value:t.form.env,callback:function(e){t.$set(t.form,\"env\",e)},expression:\"form.env\"}},t._l(t.EnvList,(function(t,e){return s(\"el-option\",{key:e+\"\",attrs:{label:t.name,value:t.name}})})),1)],1),t._v(\" \"),s(\"el-form-item\",{attrs:{label:\"Crontab\",prop:\"crontab\"}},[s(\"el-input\",{attrs:{disabled:\"run\"===t.taskVType,type:\"textarea\",rows:3},model:{value:t.form.crontab,callback:function(e){t.$set(t.form,\"crontab\",\"string\"===typeof e?e.trim():e)},expression:\"form.crontab\"}})],1),t._v(\" \"),s(\"el-form-item\",{attrs:{label:\"状态:\",prop:\"status\"}},[s(\"el-select\",{attrs:{disabled:\"run\"===t.taskVType,placeholder:\"状态\"},model:{value:t.form.status,callback:function(e){t.$set(t.form,\"status\",e)},expression:\"form.status\"}},t._l(t.status,(function(t,e){return s(\"el-option\",{key:e+\"\",attrs:{label:t.label,value:t.value}})})),1)],1),t._v(\" \"),s(\"el-form-item\",{attrs:{label:\"结果反馈:\",prop:\"sendEmail\"}},[s(\"el-select\",{attrs:{placeholder:\"结果反馈\"},model:{value:t.form.sendEmail,callback:function(e){t.$set(t.form,\"sendEmail\",e)},expression:\"form.sendEmail\"}},t._l(t.sendEmail,(function(t,e){return s(\"el-option\",{key:e+\"\",attrs:{label:t.label,value:t.value}})})),1)],1),t._v(\" \"),s(\"el-form-item\",{attrs:{label:\"收件人\",prop:\"emails\"}},[s(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{filterable:\"\",multiple:\"\",placeholder:\"请选择\"},model:{value:t.form.emails,callback:function(e){t.$set(t.form,\"emails\",e)},expression:\"form.emails\"}},t._l(t.memberData,(function(t){return s(\"el-option\",{key:t.userEmail,attrs:{label:t.username,value:t.userEmail}})})),1)],1),t._v(\" \"),s(\"el-form-item\",[s(\"el-button\",{nativeOn:{click:function(e){t.taskVShow=!1}}},[t._v(\"取消\")]),t._v(\" \"),s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"run\"!==t.taskVType,expression:\"taskVType!=='run'\"}],attrs:{type:\"primary\",loading:t.editLoading},nativeOn:{click:function(e){return t.editSubmit(e)}}},[t._v(\"保存\")]),t._v(\" \"),s(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"run\"===t.taskVType,expression:\"taskVType==='run'\"}],attrs:{type:\"primary\",loading:t.editLoading},nativeOn:{click:function(e){return t.runSubmit(e)}}},[t._v(\"执行\")])],1)],1)],1),t._v(\" \"),s(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:t.listLoading,expression:\"listLoading\"}],staticStyle:{width:\"100%\"},attrs:{data:t.tasklist,stripe:\"\",border:\"\",\"highlight-current-row\":\"\"},on:{\"selection-change\":t.selsChange}},[s(\"el-table-column\",{attrs:{type:\"selection\",\"min-width\":\"5%\"}}),t._v(\" \"),s(\"el-table-column\",{attrs:{prop:\"id\",sortable:\"\",label:\"ID\",\"min-width\":\"5%\"}}),t._v(\" \"),s(\"el-table-column\",{attrs:{prop:\"name\",sortable:\"\",label:\"任务名称\",\"min-width\":\"15%\",\"show-overflow-tooltip\":\"\"}}),t._v(\" \"),s(\"el-table-column\",{attrs:{prop:\"automationName\",label:\"用例名称\",\"min-width\":\"15%\",\"show-overflow-tooltip\":\"\"}}),t._v(\" \"),s(\"el-table-column\",{attrs:{prop:\"crontab\",label:\"执行时间\",\"min-width\":\"10%\",\"show-overflow-tooltip\":\"\"}}),t._v(\" \"),s(\"el-table-column\",{attrs:{prop:\"env\",sortable:\"\",label:\"执行环境\",\"min-width\":\"10%\",\"show-overflow-tooltip\":\"\"}}),t._v(\" \"),s(\"el-table-column\",{attrs:{prop:\"status\",label:\"状态\",\"min-width\":\"5%\",\"show-overflow-tooltip\":\"\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[s(\"img\",{directives:[{name:\"show\",rawName:\"v-show\",value:e.row.status,expression:\"scope.row.status\"}],attrs:{src:a(\"4928\")}}),t._v(\" \"),s(\"img\",{directives:[{name:\"show\",rawName:\"v-show\",value:!e.row.status,expression:\"!scope.row.status\"}],attrs:{src:a(\"60be\")}})]}}])}),t._v(\" \"),s(\"el-table-column\",{attrs:{label:\"操作\",\"min-width\":\"25%\"},scopedSlots:t._u([{key:\"default\",fn:function(e){return[s(\"el-dropdown\",[s(\"el-button\",{attrs:{type:\"primary\",size:\"small\",plain:\"\"},on:{click:function(a){return t.handleEdit(e.$index,e.row)}}},[t._v(\"修改\"),s(\"i\",{staticClass:\"el-icon-arrow-down el-icon--right\"})]),t._v(\" \"),s(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},[s(\"el-dropdown-item\",[s(\"el-button\",{attrs:{type:\"success\",size:\"small\",plain:\"\"},on:{click:function(a){return t.handleRun(e.$index,e.row)}}},[t._v(\"执行\")])],1),t._v(\" \"),s(\"el-dropdown-item\",[s(\"el-button\",{attrs:{type:\"info\",size:\"small\",plain:\"\"},on:{click:function(a){return t.handleChangeStatus(e.$index,e.row)}}},[t._v(t._s(!1===e.row.status?\"启用\":\"禁用\"))])],1),t._v(\" \"),s(\"el-dropdown-item\",[s(\"el-button\",{attrs:{type:\"primary\",size:\"small\",plain:\"\"},on:{click:function(a){return t.handleCopy(e.$index,e.row)}}},[t._v(\"复制\")])],1),t._v(\" \"),s(\"el-dropdown-item\",[s(\"el-button\",{attrs:{type:\"danger\",size:\"small\",plain:\"\"},on:{click:function(a){return t.handleDel(e.$index,e.row)}}},[t._v(\"删除\")])],1)],1)],1)]}}])})],1),t._v(\" \"),s(\"el-col\",{staticClass:\"toolbar\",attrs:{span:24}},[s(\"el-button\",{attrs:{type:\"danger\",disabled:0===this.sels.length},on:{click:t.batchRemove}},[t._v(\"批量删除\")]),t._v(\" \"),s(\"el-pagination\",{staticStyle:{float:\"right\"},attrs:{layout:\"total, prev, pager, next\",\"current-page\":t.page,total:t.total,\"page-size\":20,\"page-count\":t.pages},on:{\"current-change\":t.handleCurrentChange,\"update:currentPage\":function(e){t.page=e},\"update:current-page\":function(e){t.page=e}}})],1)],1)},n=[],o=(a(\"c5f6\"),a(\"7f7f\"),a(\"ac6a\"),a(\"4ec3\")),i=(a(\"1157\"),a(\"c1df\"),a(\"bc3a\")),r=a.n(i),l={data:function(){return{status:[{value:!0,label:\"启动\"},{value:!1,label:\"停止\"}],sendEmail:[{value:0,label:\"不发送\"},{value:1,label:\"发送\"}],filters:{name:\"\"},env:\"\",EnvList:[],automationlist:[],memberData:[],tasklist:[],total:0,page:1,pages:0,listLoading:!1,editLoading:!1,sels:[],taskVShow:!1,taskVType:\"add\",formTitle:\"定时任务\",delLoading:!1,disDel:!0,form:{id:\"\",name:\"\",env:\"\",automations:[],params:\"\",crontab:\"\",status:\"true\",sendEmail:0,emails:[]},formRules:{name:[{required:!0,message:\"请输入任务名称\",trigger:\"blur\"},{min:1,max:50,message:\"长度在 1 到 50 个字符\",trigger:\"blur\"}],env:[{required:!0,message:\"请选择执行环境\"}],automation:[{required:!0,message:\"请选择执行的用例集\"}],crontab:[{required:!0,message:\"请输入crontab表达式\"}]}}},methods:{getAutomationList:function(){var t=this,e={project_id:this.$route.params.project_id,page:t.page,page_size:1e3};r.a.get(o[\"f\"]+\"/api/automation/automation_list\",{params:e,headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){var a=e.data;\"999999\"===a.code?(t.automationlist=[],a.data.data.forEach((function(e){t.automationlist.push(e)}))):t.$message.error({message:a.msg,center:!0})})).catch((function(t){}))},getProjectMember:function(){var t=this,e={project_id:this.$route.params.project_id,page:t.page,page_size:100},a={\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")};r.a.get(\"\".concat(o[\"f\"],\"/api/member/project_member\"),{params:e,headers:a}).then((function(e){var a=e.data,s=a.msg,n=a.code,o=a.data;\"999999\"===n?t.memberData=o.data:t.$message.error({message:s,center:!0})}))},handleSearch:function(){this.page=1,this.getTaskList()},getTaskList:function(){var t=this;t.listLoading=!0;var e={project_id:this.$route.params.project_id,page:t.page,name:t.filters.name};r.a.get(o[\"f\"]+\"/api/automation/task_list\",{params:e,headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){var a=e.data;t.listLoading=!1,\"999999\"===a.code?(t.total=a.data.total,t.pages=a.data.pages,t.tasklist=[],a.data.data.forEach((function(e){t.tasklist.push(e)}))):t.$message.error({message:a.msg,center:!0})})).catch((function(t){}))},handleDel:function(t,e){var a=this;this.$confirm(\"确认删除任务[\"+e.name+\"]吗?\",\"提示\",{type:\"warning\"}).then((function(){var t=a;t.listLoading=!0;var s=JSON.stringify({project_id:Number(a.$route.params.project_id),ids:[e.id]});r.a.post(o[\"f\"]+\"/api/automation/del_task\",s,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){t.listLoading=!1;var a=e.data;\"999999\"===a.code?t.$message({message:\"删除成功\",center:!0,type:\"success\"}):t.$message.error({message:a.msg,center:!0}),t.getTaskList()})).catch((function(t){}))})).catch((function(){}))},handleCurrentChange:function(t){this.page=t,this.getTaskList()},selsChange:function(t){t.length>0?(this.sels=t,this.update=!1):this.update=!0},batchRemove:function(){var t=this,e=this.sels.map((function(t){return t.id})),a=this;this.$confirm(\"确认删除选中任务吗？\",\"提示\",{type:\"warning\"}).then((function(){a.listLoading=!0,r.a.post(o[\"f\"]+\"/api/automation/del_task\",JSON.stringify({project_id:Number(t.$route.params.project_id),ids:e}),{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){var e=t.data;a.listLoading=!1,\"999999\"===e.code?a.$message({message:\"删除成功\",center:!0,type:\"success\"}):a.$message.error({message:e.msg,center:!0}),a.getTaskList()})).catch((function(t){}))})).catch((function(){}))},handleEdit:function(t,e){this.formTitle=\"编辑\",this.taskVType=\"edit\",this.taskVShow=!0,this.form=Object.assign({},e)},handleAdd:function(){this.formTitle=\"新增\",this.taskVType=\"add\",this.taskVShow=!0,this.form={name:\"\",env:\"\",automations:[],params:\"{}\",crontab:\"0 * * * *\",status:!0,sendEmail:0,emails:[]}},handleCopy:function(t,e){this.formTitle=\"复制\";var a=Object.assign({},e);delete a[\"id\"],this.form=a,this.taskVShow=!0,this.taskVType=\"copy\"},editSubmit:function(){var t=this;if(0!=this.form.automations.length){var e=this;this.$refs.form.validate((function(a){a&&t.$confirm(\"确认提交吗？\",\"提示\",{}).then((function(){e.editLoading=!0;var a={project_id:Number(t.$route.params.project_id),automations:JSON.stringify(e.form.automations),name:e.form.name,params:e.form.params,env:e.form.env,crontab:e.form.crontab,status:e.form.status,sendEmail:e.form.sendEmail,emails:JSON.stringify(e.form.emails)},s=o[\"f\"]+\"/api/automation/add_task\";null!=e.form.id&&(a[\"id\"]=Number(e.form.id),s=o[\"f\"]+\"/api/automation/update_task\"),r.a.post(s,a,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){var a=t.data;e.editLoading=!1,\"999999\"===a.code?(e.$message({message:\"执行成功\",center:!0,type:\"success\"}),e.$refs[\"form\"].resetFields(),e.taskVShow=!1,e.getTaskList()):(a.code,e.$message.error({message:a.msg,center:!0}))})).catch((function(t){}))})).catch((function(){}))}))}else this.$message.error({message:\"请选择用例!\",center:!0})},handleChangeStatus:function(t,e){var a=this,s=\"\",n=\"\";this.listLoading=!0;var i=JSON.stringify({project_id:Number(this.$route.params.project_id),id:e.id});e.status?(s=o[\"f\"]+\"/api/automation/stop_task\",n=\"禁用成功\"):(s=o[\"f\"]+\"/api/automation/start_task\",n=\"启用成功\"),r.a.post(s,i,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){var s=t.data,o=s.msg,i=s.code;s.data;a.listLoading=!1,\"999999\"===i?(a.$message({message:n,center:!0,type:\"success\"}),e.status=!e.status):a.$message.error({message:o,center:!0})})).catch((function(t){}))},handleRun:function(t,e){this.formTitle=\"执行\",this.taskVShow=!0,this.taskVType=\"run\",this.form=Object.assign({},e)},runSubmit:function(){var t=this;this.$confirm(\"确认执行定时任务[\"+this.form.name+\"]吗?\",\"提示\",{}).then((function(){var e=t;t.listLoading=!0;var a={project_id:Number(t.$route.params.project_id),id:e.form.id,sendEmail:e.form.sendEmail,emails:e.form.emails};r.a.post(o[\"f\"]+\"/api/automation/execute_task\",a,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){var a=t.data,s=a.msg,n=a.code;a.data;e.listLoading=!1,e.taskVShow=!1,\"999999\"===n?e.$message({message:\"开始执行\",center:!0,type:\"success\"}):e.$message.error({message:s,center:!0})})).catch((function(t){}))})).catch((function(){}))},getEnv:function(){var t=this,e={Authorization:\"Token \"+sessionStorage.getItem(\"token\")};Object(o[\"b\"])(e,{project_id:t.$route.params.project_id,page:t.page,name:\"\",type:\"env\"}).then((function(e){\"999999\"===e.code?e.data.data.forEach((function(e){e.status&&t.EnvList.push(e)})):t.$message.error({message:e.msg,center:!0})}))},init:function(){this.getTaskList(),this.getAutomationList(),this.getProjectMember(),this.getEnv()}},mounted:function(){this.init()},watch:{$route:function(t,e){t.query!=e.query&&this.init()}}},m=l,c=(a(\"4b7f\"),a(\"2877\")),u=Object(c[\"a\"])(m,s,n,!1,null,\"8fc38e1a\",null);e[\"default\"]=u.exports},4928:function(t,e,a){t.exports=a.p+\"static/img/icon-yes.d2f9f035.svg\"},\"4b7f\":function(t,e,a){\"use strict\";var s=a(\"d418\"),n=a.n(s);n.a},\"60be\":function(t,e,a){t.exports=a.p+\"static/img/icon-no.439e8214.svg\"},d418:function(t,e,a){}}]);","extractedComments":[]}