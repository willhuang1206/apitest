{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-fe7de756\"],{\"22a7\":function(e,t,a){},4928:function(e,t,a){e.exports=a.p+\"static/img/icon-yes.d2f9f035.svg\"},\"60be\":function(e,t,a){e.exports=a.p+\"static/img/icon-no.439e8214.svg\"},9367:function(e,t,a){\"use strict\";a.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i(\"div\",{staticStyle:{margin:\"35px\"}},[i(\"el-col\",{staticClass:\"toolbar\",staticStyle:{\"padding-bottom\":\"0px\"},attrs:{span:24}},[i(\"el-form\",{attrs:{inline:!0,model:e.filters},nativeOn:{submit:function(e){e.preventDefault()}}},[i(\"el-form-item\",[i(\"el-input\",{attrs:{placeholder:\"名称\"},nativeOn:{keyup:function(t){return!t.type.indexOf(\"key\")&&e._k(t.keyCode,\"enter\",13,t.key,\"Enter\")?null:e.handleSearch(t)}},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,\"name\",\"string\"===typeof t?t.trim():t)},expression:\"filters.name\"}})],1),e._v(\" \"),i(\"el-form-item\",[i(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.handleSearch}},[e._v(\"查询\")])],1),e._v(\" \"),i(\"el-form-item\",[i(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.handleAdd}},[e._v(\"新增\")])],1)],1)],1),e._v(\" \"),i(\"el-dialog\",{attrs:{width:\"40%\",title:e.formTitle,visible:e.publishVShow,\"close-on-click-modal\":!1},on:{\"update:visible\":function(t){e.publishVShow=t}}},[i(\"el-form\",{ref:\"form\",attrs:{model:e.form,\"label-width\":\"100px\",rules:e.formRules}},[i(\"el-form-item\",{attrs:{label:\"发布项目：\",prop:\"name\"}},[i(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{filterable:\"\",disabled:\"run\"===e.publishVType,placeholder:\"请选择\"},model:{value:e.form.name,callback:function(t){e.$set(e.form,\"name\",t)},expression:\"form.name\"}},e._l(e.publishlist,(function(e,t){return i(\"el-option\",{key:t+\"\",attrs:{label:e,value:e}})})),1)],1),e._v(\" \"),i(\"el-form-item\",{attrs:{label:\"用例：\",prop:\"automations\"}},[i(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{filterable:\"\",multiple:\"\",disabled:\"run\"===e.publishVType,placeholder:\"请选择\"},model:{value:e.form.automations,callback:function(t){e.$set(e.form,\"automations\",t)},expression:\"form.automations\"}},e._l(e.automationlist,(function(e){return i(\"el-option\",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(\" \"),i(\"el-form-item\",{attrs:{label:\"执行环境\",prop:\"env\"}},[i(\"el-select\",{attrs:{disabled:\"run\"===e.publishVType,placeholder:\"执行环境\"},model:{value:e.form.env,callback:function(t){e.$set(e.form,\"env\",t)},expression:\"form.env\"}},e._l(e.EnvList,(function(e,t){return i(\"el-option\",{key:t+\"\",attrs:{label:e.name,value:e.name}})})),1)],1),e._v(\" \"),i(\"el-form-item\",{attrs:{label:\"状态:\",prop:\"status\"}},[i(\"el-select\",{attrs:{disabled:\"run\"===e.publishVType,placeholder:\"状态\"},model:{value:e.form.status,callback:function(t){e.$set(e.form,\"status\",t)},expression:\"form.status\"}},e._l(e.status,(function(e,t){return i(\"el-option\",{key:t+\"\",attrs:{label:e.label,value:e.value}})})),1)],1),e._v(\" \"),i(\"el-form-item\",{attrs:{label:\"结果反馈:\",prop:\"sendEmail\"}},[i(\"el-select\",{attrs:{placeholder:\"结果反馈\"},model:{value:e.form.sendEmail,callback:function(t){e.$set(e.form,\"sendEmail\",t)},expression:\"form.sendEmail\"}},e._l(e.sendEmail,(function(e,t){return i(\"el-option\",{key:t+\"\",attrs:{label:e.label,value:e.value}})})),1)],1),e._v(\" \"),i(\"el-form-item\",{attrs:{label:\"收件人\",prop:\"emails\"}},[i(\"el-select\",{staticStyle:{width:\"100%\"},attrs:{filterable:\"\",multiple:\"\",placeholder:\"请选择\"},model:{value:e.form.emails,callback:function(t){e.$set(e.form,\"emails\",t)},expression:\"form.emails\"}},e._l(e.memberData,(function(e){return i(\"el-option\",{key:e.userEmail,attrs:{label:e.username,value:e.userEmail}})})),1)],1),e._v(\" \"),i(\"el-form-item\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"run\"===e.publishVType,expression:\"publishVType==='run'\"}],attrs:{label:\"上线单ID\",prop:\"publishId\"}},[i(\"el-input\",{attrs:{\"auto-complete\":\"off\"},model:{value:e.form.publishId,callback:function(t){e.$set(e.form,\"publishId\",\"string\"===typeof t?t.trim():t)},expression:\"form.publishId\"}})],1),e._v(\" \"),i(\"el-form-item\",[i(\"el-button\",{nativeOn:{click:function(t){e.publishVShow=!1}}},[e._v(\"取消\")]),e._v(\" \"),i(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"run\"!==e.publishVType,expression:\"publishVType!=='run'\"}],attrs:{type:\"primary\",loading:e.editLoading},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v(\"保存\")]),e._v(\" \"),i(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:\"run\"===e.publishVType,expression:\"publishVType==='run'\"}],attrs:{type:\"primary\",loading:e.editLoading},nativeOn:{click:function(t){return e.runSubmit(t)}}},[e._v(\"执行\")])],1)],1)],1),e._v(\" \"),i(\"el-table\",{directives:[{name:\"loading\",rawName:\"v-loading\",value:e.listLoading,expression:\"listLoading\"}],staticStyle:{width:\"100%\"},attrs:{data:e.publishConfigList,stripe:\"\",border:\"\",\"highlight-current-row\":\"\"},on:{\"selection-change\":e.selsChange}},[i(\"el-table-column\",{attrs:{type:\"selection\",\"min-width\":\"5%\"}}),e._v(\" \"),i(\"el-table-column\",{attrs:{prop:\"id\",sortable:\"\",label:\"ID\",\"min-width\":\"5%\"}}),e._v(\" \"),i(\"el-table-column\",{attrs:{prop:\"name\",sortable:\"\",label:\"发布项目名称\",\"min-width\":\"15%\",\"show-overflow-tooltip\":\"\"}}),e._v(\" \"),i(\"el-table-column\",{attrs:{prop:\"automationName\",label:\"用例名称\",\"min-width\":\"15%\",\"show-overflow-tooltip\":\"\"}}),e._v(\" \"),i(\"el-table-column\",{attrs:{prop:\"env\",sortable:\"\",label:\"执行环境\",\"min-width\":\"10%\",\"show-overflow-tooltip\":\"\"}}),e._v(\" \"),i(\"el-table-column\",{attrs:{prop:\"status\",label:\"状态\",\"min-width\":\"5%\",\"show-overflow-tooltip\":\"\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[i(\"img\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.row.status,expression:\"scope.row.status\"}],attrs:{src:a(\"4928\")}}),e._v(\" \"),i(\"img\",{directives:[{name:\"show\",rawName:\"v-show\",value:!t.row.status,expression:\"!scope.row.status\"}],attrs:{src:a(\"60be\")}})]}}])}),e._v(\" \"),i(\"el-table-column\",{attrs:{label:\"操作\",\"min-width\":\"25%\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[i(\"el-dropdown\",[i(\"el-button\",{attrs:{type:\"primary\",size:\"small\",plain:\"\"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v(\"修改\"),i(\"i\",{staticClass:\"el-icon-arrow-down el-icon--right\"})]),e._v(\" \"),i(\"el-dropdown-menu\",{attrs:{slot:\"dropdown\"},slot:\"dropdown\"},[i(\"el-dropdown-item\",[i(\"el-button\",{attrs:{type:\"success\",size:\"small\",plain:\"\"},on:{click:function(a){return e.handleRun(t.$index,t.row)}}},[e._v(\"执行\")])],1),e._v(\" \"),i(\"el-dropdown-item\",[i(\"el-button\",{attrs:{type:\"info\",size:\"small\",plain:\"\"},on:{click:function(a){return e.handleChangeStatus(t.$index,t.row)}}},[e._v(e._s(!1===t.row.status?\"启用\":\"禁用\"))])],1),e._v(\" \"),i(\"el-dropdown-item\",[i(\"el-button\",{attrs:{type:\"primary\",size:\"small\",plain:\"\"},on:{click:function(a){return e.handleCopy(t.$index,t.row)}}},[e._v(\"复制\")])],1),e._v(\" \"),i(\"el-dropdown-item\",[i(\"el-button\",{attrs:{type:\"danger\",size:\"small\",plain:\"\"},on:{click:function(a){return e.handleDel(t.$index,t.row)}}},[e._v(\"删除\")])],1)],1)],1)]}}])})],1),e._v(\" \"),i(\"el-col\",{staticClass:\"toolbar\",attrs:{span:24}},[i(\"el-button\",{attrs:{type:\"danger\",disabled:0===this.sels.length},on:{click:e.batchRemove}},[e._v(\"批量删除\")]),e._v(\" \"),i(\"el-pagination\",{staticStyle:{float:\"right\"},attrs:{layout:\"total, prev, pager, next\",\"current-page\":e.page,total:e.total,\"page-size\":20,\"page-count\":e.pages},on:{\"current-change\":e.handleCurrentChange,\"update:currentPage\":function(t){e.page=t},\"update:current-page\":function(t){e.page=t}}})],1)],1)},s=[],n=(a(\"c5f6\"),a(\"7f7f\"),a(\"ac6a\"),a(\"4ec3\")),o=(a(\"1157\"),a(\"c1df\"),a(\"bc3a\")),r=a.n(o),l={data:function(){return{status:[{value:!0,label:\"启动\"},{value:!1,label:\"停止\"}],sendEmail:[{value:0,label:\"不发送\"},{value:1,label:\"发送\"}],filters:{name:\"\"},env:\"\",EnvList:[],automationlist:[],memberData:[],publishlist:[],publishConfigList:[],total:0,page:1,pages:0,listLoading:!1,editLoading:!1,sels:[],publishVShow:!1,publishVType:\"add\",formTitle:\"发布项目配置\",delLoading:!1,disDel:!0,form:{id:\"\",name:\"\",env:\"\",automations:[],params:\"{}\",status:\"true\",sendEmail:0,emails:[],publishId:\"\"},formRules:{name:[{required:!0,message:\"请选择发布项目\"}],env:[{required:!0,message:\"请选择执行环境\"}],automation:[{required:!0,message:\"请选择执行的用例\"}]}}},methods:{getPublish:function(){if(0==this.publishlist.length){var e=this,t={Authorization:\"Token \"+sessionStorage.getItem(\"token\")};Object(n[\"a\"])(t,{}).then((function(t){\"999999\"===t.code?t.data.forEach((function(t){e.publishlist.push(t)})):e.$message.error({message:t.msg,center:!0})}))}},getAutomationList:function(){var e=this,t={project_id:this.$route.params.project_id,page:e.page,page_size:1e3};r.a.get(n[\"f\"]+\"/api/automation/automation_list\",{params:t,headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){var a=t.data;\"999999\"===a.code?(e.automationlist=[],a.data.data.forEach((function(t){e.automationlist.push(t)}))):e.$message.error({message:a.msg,center:!0})})).catch((function(e){}))},getProjectMember:function(){var e=this,t={project_id:this.$route.params.project_id,page:e.page,page_size:100},a={\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")};r.a.get(\"\".concat(n[\"f\"],\"/api/member/project_member\"),{params:t,headers:a}).then((function(t){var a=t.data,i=a.msg,s=a.code,n=a.data;\"999999\"===s?e.memberData=n.data:e.$message.error({message:i,center:!0})}))},handleSearch:function(){this.page=1,this.getPublishList()},getPublishList:function(){var e=this,t={project_id:this.$route.params.project_id,page:e.page,name:e.filters.name};r.a.get(n[\"f\"]+\"/api/automation/publish_list\",{params:t,headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){var a=t.data;\"999999\"===a.code?(e.total=a.data.total,e.pages=a.data.pages,e.publishConfigList=[],a.data.data.forEach((function(t){e.publishConfigList.push(t)}))):e.$message.error({message:a.msg,center:!0})})).catch((function(e){}))},handleDel:function(e,t){var a=this;this.$confirm(\"确认删除发布项目配置[\"+t.name+\",\"+t.env+\"]吗?\",\"提示\",{type:\"warning\"}).then((function(){a.listLoading=!0;var e=a,i=JSON.stringify({project_id:Number(a.$route.params.project_id),ids:[t.id]});r.a.post(n[\"f\"]+\"/api/automation/del_publish\",i,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(t){a.listLoading=!1;var i=t.data;\"999999\"===i.code?e.$message({message:\"删除成功\",center:!0,type:\"success\"}):e.$message.error({message:i.msg,center:!0}),e.getPublishList()})).catch((function(e){}))})).catch((function(){}))},handleCurrentChange:function(e){this.page=e,this.getPublishList()},selsChange:function(e){e.length>0&&(this.sels=e)},batchRemove:function(){var e=this,t=this.sels.map((function(e){return e.id})),a=this;this.$confirm(\"确认删除选中发布项目配置吗？\",\"提示\",{type:\"warning\"}).then((function(){a.listLoading=!0,r.a.post(n[\"f\"]+\"/api/automation/del_publish\",JSON.stringify({project_id:Number(e.$route.params.project_id),ids:t}),{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){var t=e.data;a.listLoading=!1,\"999999\"===t.code?a.$message({message:\"删除成功\",center:!0,type:\"success\"}):a.$message.error({message:t.msg,center:!0}),a.getPublishList()})).catch((function(e){}))})).catch((function(){}))},handleEdit:function(e,t){this.formTitle=\"编辑\",this.publishVShow=!0,this.publishVType=\"update\",this.form=Object.assign({},t)},handleRun:function(e,t){this.formTitle=\"执行\",this.publishVShow=!0,this.publishVType=\"run\",this.form=Object.assign({},t)},handleAdd:function(){this.formTitle=\"新增\",this.publishVShow=!0,this.publishVType=\"add\",this.form={name:\"\",env:\"\",automations:[],params:\"{}\",status:!0,sendEmail:0,emails:[]}},handleCopy:function(e,t){this.formTitle=\"复制\",this.publishVType=\"copy\";var a=Object.assign({},t);delete a[\"id\"],this.form=a,this.publishVShow=!0},editSubmit:function(){var e=this;if(0!=this.form.automations.length){var t=this;this.$refs.form.validate((function(a){a&&e.$confirm(\"确认提交吗？\",\"提示\",{}).then((function(){t.editLoading=!0;var a={project_id:Number(e.$route.params.project_id),automations:JSON.stringify(t.form.automations),name:t.form.name,params:t.form.params,env:t.form.env,status:t.form.status,sendEmail:t.form.sendEmail,emails:JSON.stringify(t.form.emails)},i=n[\"f\"]+\"/api/automation/add_publish\";null!=t.form.id&&(a[\"id\"]=Number(t.form.id),i=n[\"f\"]+\"/api/automation/update_publish\"),r.a.post(i,a,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){var a=e.data;t.editLoading=!1,\"999999\"===a.code?(t.$message({message:\"执行成功\",center:!0,type:\"success\"}),t.$refs[\"form\"].resetFields(),t.publishVShow=!1,t.getPublishList()):(a.code,t.$message.error({message:a.msg,center:!0}))})).catch((function(e){}))})).catch((function(){}))}))}else this.$message.error({message:\"请选择用例!\",center:!0})},handleChangeStatus:function(e,t){var a=this,i=\"\",s=\"\";this.listLoading=!0;var o=JSON.stringify({project_id:Number(this.$route.params.project_id),id:t.id});t.status?(i=n[\"f\"]+\"/api/automation/disable_publish\",s=\"禁用成功\"):(i=n[\"f\"]+\"/api/automation/enable_publish\",s=\"启用成功\"),r.a.post(i,o,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){var i=e.data,n=i.msg,o=i.code;i.data;a.listLoading=!1,\"999999\"===o?(a.$message({message:s,center:!0,type:\"success\"}),t.status=!t.status):a.$message.error({message:n,center:!0})})).catch((function(e){}))},runSubmit:function(){var e=this;this.form.publishId?this.$confirm(\"确认测试发布项目\"+this.form.name+\",\"+this.form.env+\"环境,上线单\"+this.form.publishId+\"吗?\",\"提示\",{}).then((function(){var t=e;e.listLoading=!0;var a={project_id:Number(e.$route.params.project_id),publish:t.form.id,id:t.form.publishId,sendEmail:t.form.sendEmail,emails:t.form.emails};r.a.post(n[\"f\"]+\"/api/automation/test_publish\",a,{headers:{\"Content-Type\":\"application/json\",Authorization:\"Token \"+sessionStorage.getItem(\"token\")}}).then((function(e){var a=e.data,i=a.msg,s=a.code;a.data;t.listLoading=!1,t.publishVShow=!1,\"999999\"===s?t.$message({message:\"开始执行\",center:!0,type:\"success\"}):t.$message.error({message:i,center:!0})})).catch((function(e){}))})).catch((function(){})):this.$message.error({message:\"请填写上线单ID!\",center:!0})},getEnv:function(){var e=this,t={Authorization:\"Token \"+sessionStorage.getItem(\"token\")};Object(n[\"b\"])(t,{project_id:e.$route.params.project_id,page:e.page,name:\"\",type:\"env\"}).then((function(t){\"999999\"===t.code?t.data.data.forEach((function(t){t.status&&e.EnvList.push(t)})):e.$message.error({message:t.msg,center:!0})}))},init:function(){this.getPublishList(),this.getAutomationList(),this.getProjectMember(),this.getEnv(),this.getPublish()}},mounted:function(){this.init()},watch:{$route:function(e,t){e.query!=t.query&&this.init()}}},u=l,m=(a(\"f3c7\"),a(\"2877\")),c=Object(m[\"a\"])(u,i,s,!1,null,\"0f72d2be\",null);t[\"default\"]=c.exports},f3c7:function(e,t,a){\"use strict\";var i=a(\"22a7\"),s=a.n(i);s.a}}]);","extractedComments":[]}